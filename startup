local args = { ... }
local branch = args[1] or "master"
local sources = {}

function source(newUser, newRepo)
  table.insert(sources, {
    user = newUser,
    repo = newRepo
  })
end

function update(path, branch)
  remove(path)
  install(path, branch)
end

function remove(path)
  if fs.exists(path) then
    fs.delete(path)
  end
end

function install(path)
  if fs.exists(path) then
    print("bootstrap: module " .. path .. " found locally")
  else
    fs.makeDir(path)
    fs.delete(path)
    local found = false
    for index, source in ipairs(sources) do
      if not found then
        local user = source.user
        local repo = source.repo
        
        local url = "https://raw.githubusercontent.com/" .. user .. "/" .. repo .. "/" .. branch .. "/" .. path
        local request = http.get(url)
        
        if request then
          local response = request.readAll()
          local file = fs.open(path, "w")
          file.write(response)
          file.close()
          found = true
        end
      end
    end
    if found then
      print("bootstrap: module " .. path .. " found remotely")
    else
      print("bootstrap: ERROR module " .. path .. " not found")
    end
  end
end

source("brooswit", "ccc")
update("module")
update("install")
update("update")
