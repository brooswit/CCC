print("MODULE: V3")
local sources = {}



local function _source(newUser, newRepo)
  table.insert(sources, {
    user = newUser,
    repo = newRepo
  })
end

function source(newUser, newRepo)
  print("MODULE: adding source '" .. newUser .. "/" .. newRepo .. "'")
  _source(newUser, newRepo)
end



local function _remove(path)
  if fs.exists(path) then
    fs.delete(path)
  end
end

function remove(path)
  print("MODULE: removing '" .. path .. "'")
  _remove(path)
end



local function _install(path, branch, user, repo, action)
  if user and repo then
    _source(user, repo)
  end
  if fs.exists(path) then
    print("MODULE: module '" .. path .. "' " .. action .. " locally")
  else
    fs.makeDir(path)
    fs.delete(path)
    local found = false
    for index, source in ipairs(sources) do
      if not found then
        local user = source.user
        local repo = source.repo
        local url = "https://raw.githubusercontent.com/" .. user .. "/" .. repo .. "/" .. branch .. "/" .. path
        local request = http.get(url)
        
        if request then
          local response = request.readAll()
          local file = fs.open(path, "w")
          file.write(response)
          file.close()
          found = true
        end
      end
    end
    if found then
      print("MODULE: module '" .. path .. "' " .. action .. " from remote")
    else
      print("MODULE: could not " .. action .. " module '" .. path .. "'")
    end
  end
end

function install(path, branch, user, repo)
  branch = branch or "master"
  _install(path, branch, user, repo, "install")
end



local function _update(path, branch, user, repo)
  _remove(path)
  _install(path, branch, user, repo, "update")
end

function update(path, branch, user, repo)
  branch = branch or "master"
  _update(path, branch, user, repo)
end



local function _require(path, branch, user, repo)
  _install(path, branch, user, repo, "require")
  if fs.exists(path) then
    os.loadAPI(path)
  end
end

function require(path, branch, user, repo)
  branch = branch or "master"
  _require(path, branch, user, repo)
end



_source("brooswit", "ccc")
