os.loadAPI("module")
module.require("json")

local store = {}

function load(storeName)
  if not stores[storeName] then
    local fileName = storeName .. ".json"
    local file

    if fs.exists("disk/" .. fileName) then
      print("STORE(" .. storeName .. "): found " .. fileName .. " on disk.")
      file = fs.open("disk/" .. fileName, "r")
    elseif fs.exists(fileName) then
      print("STORE(" .. storeName .. "): found " .. fileName .. " locally.")
      file = fs.open(fileName, "r")
    else
      print("STORE(" .. storeName .. "): " .. fileName .. " not found.")
    end
    if file then
      local serializedStore = file.readAll()
      file.close()
      stores[storeName] = json.decode(serializedConfig)
    end
  end

  return stores[storeName]
end

function save(storeName)
  local fileName = storeName .. ".json"
  local data = stores[storeName] or {}
  local serializedStore = json.encode(data)

  local file = fs.open(fileName "w")
  file.write(serializedStore)
  file.close()

  print("STORE(" .. storeName .. "): " .. fileName .. " saved.")
end



function get(storeName, dataKey) 
  local value
  load(storeName)
  if store[storeName] then
    if store[storeName][dataKey] then
      value = store[storeName][dataKey]
    end
  end
  return value
end

function set(storeName, dataKey, value)
  load(storeName)
  if not store[storeName] then
    store[storeName] = {}
  end
  if not store[storeName][dataKey] then
    store[storeName][dataKey] = value
  end
  save(storeName)
end
